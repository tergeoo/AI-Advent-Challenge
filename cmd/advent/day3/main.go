package main

import (
	"fmt"
	"log"
	"strings"
	"time"

	"github.com/georgijter-grigoranc/ai-advent-challenge/internal/client"
	"github.com/georgijter-grigoranc/ai-advent-challenge/internal/config"
	"github.com/georgijter-grigoranc/ai-advent-challenge/pkg/utils"
)

// –†–µ–∑—É–ª—å—Ç–∞—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏
type StrategyResult struct {
	StrategyName  string
	Prompt        string
	Response      string
	TokensUsed    int
	ExecutionTime time.Duration
	AnswerCorrect bool
	AnswerQuality int // –û—Ü–µ–Ω–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞ –æ—Ç 1 –¥–æ 10
}

func main() {
	// –ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
	cfg, err := config.Load()
	if err != nil {
		log.Fatalf("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏: %v", err)
	}

	// –°–æ–∑–¥–∞–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞
	aiClient := client.NewOpenAIClient(cfg.OpenAIKey)

	// –ó–∞–≥–æ–ª–æ–≤–æ–∫
	utils.PrintHeader("Day 3: –†–∞–∑–Ω—ã–µ —Å–ø–æ—Å–æ–±—ã —Ä–∞—Å—Å—É–∂–¥–µ–Ω–∏—è")

	// –û–ø–∏—Å–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏
	printProblemDescription()

	// –•—Ä–∞–Ω–∏–ª–∏—â–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
	results := make([]StrategyResult, 0, 4)

	// 1. –ü—Ä—è–º–æ–π –æ—Ç–≤–µ—Ç
	results = append(results, runStrategy1DirectAnswer(aiClient))

	// 2. –ü–æ—à–∞–≥–æ–≤–æ–µ —Ä–µ—à–µ–Ω–∏–µ
	results = append(results, runStrategy2StepByStep(aiClient))

	// 3. –ú–µ—Ç–∞-–ø—Ä–æ–º–ø—Ç (—Å–Ω–∞—á–∞–ª–∞ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º –ø—Ä–æ–º–ø—Ç)
	results = append(results, runStrategy3MetaPrompt(aiClient))

	// 4. –ì—Ä—É–ø–ø–∞ —ç–∫—Å–ø–µ—Ä—Ç–æ–≤
	results = append(results, runStrategy4ExpertPanel(aiClient))

	// –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
	compareResults(results)

	utils.PrintDivider()
	utils.PrintSuccess("–ó–∞–¥–∞–Ω–∏–µ Day 3 –≤—ã–ø–æ–ª–Ω–µ–Ω–æ!")
}

func printProblemDescription() {
	utils.PrintSection("üß©", "–ó–ê–î–ê–ß–ê")

	fmt.Println("–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∞—è –∑–∞–¥–∞—á–∞ –æ –ø–µ—Ä–µ–ø—Ä–∞–≤–µ:")
	fmt.Println()
	fmt.Println("–§–µ—Ä–º–µ—Ä—É –Ω—É–∂–Ω–æ –ø–µ—Ä–µ–≤–µ–∑—Ç–∏ —á–µ—Ä–µ–∑ —Ä–µ–∫—É –≤–æ–ª–∫–∞, –∫–æ–∑—É –∏ –∫–∞–ø—É—Å—Ç—É.")
	fmt.Println("–í –ª–æ–¥–∫–µ –ø–æ–º–µ—â–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ —Ñ–µ—Ä–º–µ—Ä –∏ –æ–¥–∏–Ω –∏–∑ –Ω–∏—Ö.")
	fmt.Println()
	fmt.Println("–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:")
	fmt.Println("  - –í–æ–ª–∫ –Ω–µ –º–æ–∂–µ—Ç –æ—Å—Ç–∞–≤–∞—Ç—å—Å—è –Ω–∞–µ–¥–∏–Ω–µ —Å –∫–æ–∑–æ–π (—Å—ä–µ—Å—Ç)")
	fmt.Println("  - –ö–æ–∑–∞ –Ω–µ –º–æ–∂–µ—Ç –æ—Å—Ç–∞–≤–∞—Ç—å—Å—è –Ω–∞–µ–¥–∏–Ω–µ —Å –∫–∞–ø—É—Å—Ç–æ–π (—Å—ä–µ—Å—Ç)")
	fmt.Println()
	fmt.Println("–í–æ–ø—Ä–æ—Å: –ö–∞–∫ –ø–µ—Ä–µ–≤–µ–∑—Ç–∏ –≤—Å–µ—Ö —á–µ—Ä–µ–∑ —Ä–µ–∫—É?")
	fmt.Println()

	utils.PrintDivider()
}

// –°—Ç—Ä–∞—Ç–µ–≥–∏—è 1: –ü—Ä—è–º–æ–π –æ—Ç–≤–µ—Ç –±–µ–∑ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π
func runStrategy1DirectAnswer(aiClient *client.OpenAIClient) StrategyResult {
	utils.PrintSection("1Ô∏è‚É£", "–°–¢–†–ê–¢–ï–ì–ò–Ø 1: –ü—Ä—è–º–æ–π –æ—Ç–≤–µ—Ç")

	prompt := `–§–µ—Ä–º–µ—Ä—É –Ω—É–∂–Ω–æ –ø–µ—Ä–µ–≤–µ–∑—Ç–∏ —á–µ—Ä–µ–∑ —Ä–µ–∫—É –≤–æ–ª–∫–∞, –∫–æ–∑—É –∏ –∫–∞–ø—É—Å—Ç—É.
–í –ª–æ–¥–∫–µ –ø–æ–º–µ—â–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ —Ñ–µ—Ä–º–µ—Ä –∏ –æ–¥–∏–Ω –∏–∑ –Ω–∏—Ö.
–í–æ–ª–∫ –Ω–µ –º–æ–∂–µ—Ç –æ—Å—Ç–∞–≤–∞—Ç—å—Å—è –Ω–∞–µ–¥–∏–Ω–µ —Å –∫–æ–∑–æ–π (—Å—ä–µ—Å—Ç).
–ö–æ–∑–∞ –Ω–µ –º–æ–∂–µ—Ç –æ—Å—Ç–∞–≤–∞—Ç—å—Å—è –Ω–∞–µ–¥–∏–Ω–µ —Å –∫–∞–ø—É—Å—Ç–æ–π (—Å—ä–µ—Å—Ç).

–ö–∞–∫ –ø–µ—Ä–µ–≤–µ–∑—Ç–∏ –≤—Å–µ—Ö —á–µ—Ä–µ–∑ —Ä–µ–∫—É?`

	fmt.Printf("–ü—Ä–æ–º–ø—Ç:\n%s\n\n", prompt)

	start := time.Now()
	resp, err := aiClient.CreateCompletion(client.CompletionRequest{
		Prompt:      prompt,
		Temperature: 0.7,
		MaxTokens:   500,
	})
	elapsed := time.Since(start)

	if err != nil {
		log.Printf("–û—à–∏–±–∫–∞: %v\n", err)
		return StrategyResult{}
	}

	fmt.Printf("–û—Ç–≤–µ—Ç:\n%s\n\n", resp.Content)
	utils.PrintTokenStats(resp.TotalTokens, resp.PromptTokens, resp.CompletionTokens)
	utils.PrintKeyValue("–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è", elapsed.String())
	utils.PrintDivider()

	return StrategyResult{
		StrategyName:  "–ü—Ä—è–º–æ–π –æ—Ç–≤–µ—Ç",
		Prompt:        prompt,
		Response:      resp.Content,
		TokensUsed:    resp.TotalTokens,
		ExecutionTime: elapsed,
	}
}

// –°—Ç—Ä–∞—Ç–µ–≥–∏—è 2: –ü–æ—à–∞–≥–æ–≤–æ–µ —Ä–µ—à–µ–Ω–∏–µ
func runStrategy2StepByStep(aiClient *client.OpenAIClient) StrategyResult {
	utils.PrintSection("2Ô∏è‚É£", "–°–¢–†–ê–¢–ï–ì–ò–Ø 2: –ü–æ—à–∞–≥–æ–≤–æ–µ —Ä–µ—à–µ–Ω–∏–µ")

	prompt := `–§–µ—Ä–º–µ—Ä—É –Ω—É–∂–Ω–æ –ø–µ—Ä–µ–≤–µ–∑—Ç–∏ —á–µ—Ä–µ–∑ —Ä–µ–∫—É –≤–æ–ª–∫–∞, –∫–æ–∑—É –∏ –∫–∞–ø—É—Å—Ç—É.
–í –ª–æ–¥–∫–µ –ø–æ–º–µ—â–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ —Ñ–µ—Ä–º–µ—Ä –∏ –æ–¥–∏–Ω –∏–∑ –Ω–∏—Ö.
–í–æ–ª–∫ –Ω–µ –º–æ–∂–µ—Ç –æ—Å—Ç–∞–≤–∞—Ç—å—Å—è –Ω–∞–µ–¥–∏–Ω–µ —Å –∫–æ–∑–æ–π (—Å—ä–µ—Å—Ç).
–ö–æ–∑–∞ –Ω–µ –º–æ–∂–µ—Ç –æ—Å—Ç–∞–≤–∞—Ç—å—Å—è –Ω–∞–µ–¥–∏–Ω–µ —Å –∫–∞–ø—É—Å—Ç–æ–π (—Å—ä–µ—Å—Ç).

–ö–∞–∫ –ø–µ—Ä–µ–≤–µ–∑—Ç–∏ –≤—Å–µ—Ö —á–µ—Ä–µ–∑ —Ä–µ–∫—É?

–í–ê–ñ–ù–û: –†–µ—à–∞–π –∑–∞–¥–∞—á—É –ø–æ—à–∞–≥–æ–≤–æ:
1. –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è
2. –û–ø—Ä–µ–¥–µ–ª–∏ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏ (–∫–æ–≥–æ –Ω–µ–ª—å–∑—è –æ—Å—Ç–∞–≤–ª—è—Ç—å –≤–º–µ—Å—Ç–µ)
3. –ù–∞–π–¥–∏ –±–µ–∑–æ–ø–∞—Å–Ω—ã–π –ø–µ—Ä–≤—ã–π —Ö–æ–¥
4. –ü—Ä–æ–¥–æ–ª–∂–∞–π —à–∞–≥ –∑–∞ —à–∞–≥–æ–º –¥–æ —Ä–µ—à–µ–Ω–∏—è
5. –ü—Ä–æ–≤–µ—Ä—å, —á—Ç–æ —Ä–µ—à–µ–Ω–∏–µ —É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä—è–µ—Ç –≤—Å–µ–º —É—Å–ª–æ–≤–∏—è–º

–ö–∞–∂–¥—ã–π —à–∞–≥ –æ–±—ä—è—Å–Ω—è–π –ø–æ–¥—Ä–æ–±–Ω–æ.`

	fmt.Printf("–ü—Ä–æ–º–ø—Ç:\n%s\n\n", prompt)

	start := time.Now()
	resp, err := aiClient.CreateCompletion(client.CompletionRequest{
		Prompt:      prompt,
		Temperature: 0.7,
		MaxTokens:   800,
	})
	elapsed := time.Since(start)

	if err != nil {
		log.Printf("–û—à–∏–±–∫–∞: %v\n", err)
		return StrategyResult{}
	}

	fmt.Printf("–û—Ç–≤–µ—Ç:\n%s\n\n", resp.Content)
	utils.PrintTokenStats(resp.TotalTokens, resp.PromptTokens, resp.CompletionTokens)
	utils.PrintKeyValue("–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è", elapsed.String())
	utils.PrintDivider()

	return StrategyResult{
		StrategyName:  "–ü–æ—à–∞–≥–æ–≤–æ–µ —Ä–µ—à–µ–Ω–∏–µ",
		Prompt:        prompt,
		Response:      resp.Content,
		TokensUsed:    resp.TotalTokens,
		ExecutionTime: elapsed,
	}
}

// –°—Ç—Ä–∞—Ç–µ–≥–∏—è 3: –ú–µ—Ç–∞-–ø—Ä–æ–º–ø—Ç (—Å–Ω–∞—á–∞–ª–∞ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º –ø—Ä–æ–º–ø—Ç)
func runStrategy3MetaPrompt(aiClient *client.OpenAIClient) StrategyResult {
	utils.PrintSection("3Ô∏è‚É£", "–°–¢–†–ê–¢–ï–ì–ò–Ø 3: –ú–µ—Ç–∞-–ø—Ä–æ–º–ø—Ç")

	// –®–∞–≥ 1: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø—Ä–æ–º–ø—Ç–∞
	metaPrompt := `–ú–Ω–µ –Ω—É–∂–Ω–æ —Ä–µ—à–∏—Ç—å —Å–ª–µ–¥—É—é—â—É—é –∑–∞–¥–∞—á—É:

–§–µ—Ä–º–µ—Ä—É –Ω—É–∂–Ω–æ –ø–µ—Ä–µ–≤–µ–∑—Ç–∏ —á–µ—Ä–µ–∑ —Ä–µ–∫—É –≤–æ–ª–∫–∞, –∫–æ–∑—É –∏ –∫–∞–ø—É—Å—Ç—É.
–í –ª–æ–¥–∫–µ –ø–æ–º–µ—â–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ —Ñ–µ—Ä–º–µ—Ä –∏ –æ–¥–∏–Ω –∏–∑ –Ω–∏—Ö.
–í–æ–ª–∫ –Ω–µ –º–æ–∂–µ—Ç –æ—Å—Ç–∞–≤–∞—Ç—å—Å—è –Ω–∞–µ–¥–∏–Ω–µ —Å –∫–æ–∑–æ–π (—Å—ä–µ—Å—Ç).
–ö–æ–∑–∞ –Ω–µ –º–æ–∂–µ—Ç –æ—Å—Ç–∞–≤–∞—Ç—å—Å—è –Ω–∞–µ–¥–∏–Ω–µ —Å –∫–∞–ø—É—Å—Ç–æ–π (—Å—ä–µ—Å—Ç).

–°–æ—Å—Ç–∞–≤—å –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–π –ø—Ä–æ–º–ø—Ç –¥–ª—è —è–∑—ã–∫–æ–≤–æ–π –º–æ–¥–µ–ª–∏, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–º–æ–∂–µ—Ç
—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ —Ä–µ—à–∏—Ç—å —ç—Ç—É –∑–∞–¥–∞—á—É. –ü—Ä–æ–º–ø—Ç –¥–æ–ª–∂–µ–Ω –≤–∫–ª—é—á–∞—Ç—å:
- –ß–µ—Ç–∫—É—é —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫—É –∑–∞–¥–∞—á–∏
- –°—Ç—Ä—É–∫—Ç—É—Ä—É –¥–ª—è –æ—Ç–≤–µ—Ç–∞
- –ü–æ–¥—Å–∫–∞–∑–∫–∏ –¥–ª—è —Ä–∞—Å—Å—É–∂–¥–µ–Ω–∏—è

–í—ã–≤–µ–¥–∏ —Ç–æ–ª—å–∫–æ —Å–∞–º –ø—Ä–æ–º–ø—Ç, –±–µ–∑ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –ø–æ—è—Å–Ω–µ–Ω–∏–π.`

	fmt.Println("–®–∞–≥ 1: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–≥–æ –ø—Ä–æ–º–ø—Ç–∞")
	fmt.Printf("–ú–µ—Ç–∞-–ø—Ä–æ–º–ø—Ç:\n%s\n\n", metaPrompt)

	start := time.Now()

	// –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –ø—Ä–æ–º–ø—Ç
	respPrompt, err := aiClient.CreateCompletion(client.CompletionRequest{
		Prompt:      metaPrompt,
		Temperature: 0.7,
		MaxTokens:   400,
	})

	if err != nil {
		log.Printf("–û—à–∏–±–∫–∞ –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ø—Ä–æ–º–ø—Ç–∞: %v\n", err)
		return StrategyResult{}
	}

	generatedPrompt := respPrompt.Content
	fmt.Printf("–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø—Ä–æ–º–ø—Ç:\n%s\n\n", generatedPrompt)
	utils.PrintTokenStats(respPrompt.TotalTokens, respPrompt.PromptTokens, respPrompt.CompletionTokens)

	fmt.Println("\n–®–∞–≥ 2: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –ø—Ä–æ–º–ø—Ç–∞")

	// –ò—Å–ø–æ–ª—å–∑—É–µ–º —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø—Ä–æ–º–ø—Ç
	respFinal, err := aiClient.CreateCompletion(client.CompletionRequest{
		Prompt:      generatedPrompt,
		Temperature: 0.7,
		MaxTokens:   600,
	})

	elapsed := time.Since(start)

	if err != nil {
		log.Printf("–û—à–∏–±–∫–∞ –ø—Ä–∏ —Ä–µ—à–µ–Ω–∏–∏: %v\n", err)
		return StrategyResult{}
	}

	fmt.Printf("–ò—Ç–æ–≥–æ–≤—ã–π –æ—Ç–≤–µ—Ç:\n%s\n\n", respFinal.Content)
	utils.PrintTokenStats(respFinal.TotalTokens, respFinal.PromptTokens, respFinal.CompletionTokens)
	utils.PrintKeyValue("–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è", elapsed.String())
	utils.PrintKeyValue("–¢–æ–∫–µ–Ω–æ–≤ –≤—Å–µ–≥–æ", fmt.Sprintf("%d", respPrompt.TotalTokens+respFinal.TotalTokens))
	utils.PrintDivider()

	return StrategyResult{
		StrategyName:  "–ú–µ—Ç–∞-–ø—Ä–æ–º–ø—Ç",
		Prompt:        generatedPrompt,
		Response:      respFinal.Content,
		TokensUsed:    respPrompt.TotalTokens + respFinal.TotalTokens,
		ExecutionTime: elapsed,
	}
}

// –°—Ç—Ä–∞—Ç–µ–≥–∏—è 4: –ì—Ä—É–ø–ø–∞ —ç–∫—Å–ø–µ—Ä—Ç–æ–≤
func runStrategy4ExpertPanel(aiClient *client.OpenAIClient) StrategyResult {
	utils.PrintSection("4Ô∏è‚É£", "–°–¢–†–ê–¢–ï–ì–ò–Ø 4: –ì—Ä—É–ø–ø–∞ —ç–∫—Å–ø–µ—Ä—Ç–æ–≤")

	// –û–ø—Ä–µ–¥–µ–ª—è–µ–º —ç–∫—Å–ø–µ—Ä—Ç–æ–≤
	experts := []struct {
		Role   string
		Emoji  string
		Prompt string
	}{
		{
			Role:  "–õ–æ–≥–∏–∫-–∞–Ω–∞–ª–∏—Ç–∏–∫",
			Emoji: "üß†",
			Prompt: `–¢—ã ‚Äî —ç–∫—Å–ø–µ—Ä—Ç –ø–æ –ª–æ–≥–∏—á–µ—Å–∫–∏–º –∑–∞–¥–∞—á–∞–º –∏ –∫–æ–º–±–∏–Ω–∞—Ç–æ—Ä–∏–∫–µ.

–ó–ê–î–ê–ß–ê:
–§–µ—Ä–º–µ—Ä—É –Ω—É–∂–Ω–æ –ø–µ—Ä–µ–≤–µ–∑—Ç–∏ —á–µ—Ä–µ–∑ —Ä–µ–∫—É –≤–æ–ª–∫–∞, –∫–æ–∑—É –∏ –∫–∞–ø—É—Å—Ç—É.
–í –ª–æ–¥–∫–µ –ø–æ–º–µ—â–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ —Ñ–µ—Ä–º–µ—Ä –∏ –æ–¥–∏–Ω –∏–∑ –Ω–∏—Ö.
–í–æ–ª–∫ –Ω–µ –º–æ–∂–µ—Ç –æ—Å—Ç–∞–≤–∞—Ç—å—Å—è –Ω–∞–µ–¥–∏–Ω–µ —Å –∫–æ–∑–æ–π (—Å—ä–µ—Å—Ç).
–ö–æ–∑–∞ –Ω–µ –º–æ–∂–µ—Ç –æ—Å—Ç–∞–≤–∞—Ç—å—Å—è –Ω–∞–µ–¥–∏–Ω–µ —Å –∫–∞–ø—É—Å—Ç–æ–π (—Å—ä–µ—Å—Ç).

–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π –∑–∞–¥–∞—á—É —Å —Ç–æ—á–∫–∏ –∑—Ä–µ–Ω–∏—è –ª–æ–≥–∏–∫–∏:
- –û–ø—Ä–µ–¥–µ–ª–∏ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ —Å–æ—Å—Ç–æ—è–Ω–∏–π
- –ù–∞–π–¥–∏ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è
- –ü—Ä–µ–¥–ª–æ–∂–∏ –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ

–ë—É–¥—å —Ç–æ—á–Ω—ã–º –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–º.`,
		},
		{
			Role:  "–ò–≥—Ä–æ–≤–æ–π —Ç–µ–æ—Ä–µ—Ç–∏–∫",
			Emoji: "üéÆ",
			Prompt: `–¢—ã ‚Äî —ç–∫—Å–ø–µ—Ä—Ç –ø–æ —Ç–µ–æ—Ä–∏–∏ –∏–≥—Ä –∏ –∞–ª–≥–æ—Ä–∏—Ç–º–∞–º.

–ó–ê–î–ê–ß–ê:
–§–µ—Ä–º–µ—Ä—É –Ω—É–∂–Ω–æ –ø–µ—Ä–µ–≤–µ–∑—Ç–∏ —á–µ—Ä–µ–∑ —Ä–µ–∫—É –≤–æ–ª–∫–∞, –∫–æ–∑—É –∏ –∫–∞–ø—É—Å—Ç—É.
–í –ª–æ–¥–∫–µ –ø–æ–º–µ—â–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ —Ñ–µ—Ä–º–µ—Ä –∏ –æ–¥–∏–Ω –∏–∑ –Ω–∏—Ö.
–í–æ–ª–∫ –Ω–µ –º–æ–∂–µ—Ç –æ—Å—Ç–∞–≤–∞—Ç—å—Å—è –Ω–∞–µ–¥–∏–Ω–µ —Å –∫–æ–∑–æ–π (—Å—ä–µ—Å—Ç).
–ö–æ–∑–∞ –Ω–µ –º–æ–∂–µ—Ç –æ—Å—Ç–∞–≤–∞—Ç—å—Å—è –Ω–∞–µ–¥–∏–Ω–µ —Å –∫–∞–ø—É—Å—Ç–æ–π (—Å—ä–µ—Å—Ç).

–†–∞—Å—Å–º–æ—Ç—Ä–∏ –∑–∞–¥–∞—á—É –∫–∞–∫ –≥—Ä–∞—Ñ —Å–æ—Å—Ç–æ—è–Ω–∏–π:
- –ö–∞–∫–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –≤–æ–∑–º–æ–∂–Ω—ã?
- –ö–∞–∫–∏–µ –ø–µ—Ä–µ—Ö–æ–¥—ã –¥–æ–ø—É—Å—Ç–∏–º—ã?
- –ù–∞–π–¥–∏ –∫—Ä–∞—Ç—á–∞–π—à–∏–π –ø—É—Ç—å –∫ —Ü–µ–ª–∏

–û–ø–∏—à–∏ —Ä–µ—à–µ–Ω–∏–µ –≤ —Ç–µ—Ä–º–∏–Ω–∞—Ö –≥—Ä–∞—Ñ–æ–≤ –∏ –ø–æ–∏—Å–∫–∞.`,
		},
		{
			Role:  "–ö—Ä–∏—Ç–∏–∫-–≤–µ—Ä–∏—Ñ–∏–∫–∞—Ç–æ—Ä",
			Emoji: "üîç",
			Prompt: `–¢—ã ‚Äî —ç–∫—Å–ø–µ—Ä—Ç –ø–æ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏ —Ä–µ—à–µ–Ω–∏–π.

–ó–ê–î–ê–ß–ê:
–§–µ—Ä–º–µ—Ä—É –Ω—É–∂–Ω–æ –ø–µ—Ä–µ–≤–µ–∑—Ç–∏ —á–µ—Ä–µ–∑ —Ä–µ–∫—É –≤–æ–ª–∫–∞, –∫–æ–∑—É –∏ –∫–∞–ø—É—Å—Ç—É.
–í –ª–æ–¥–∫–µ –ø–æ–º–µ—â–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ —Ñ–µ—Ä–º–µ—Ä –∏ –æ–¥–∏–Ω –∏–∑ –Ω–∏—Ö.
–í–æ–ª–∫ –Ω–µ –º–æ–∂–µ—Ç –æ—Å—Ç–∞–≤–∞—Ç—å—Å—è –Ω–∞–µ–¥–∏–Ω–µ —Å –∫–æ–∑–æ–π (—Å—ä–µ—Å—Ç).
–ö–æ–∑–∞ –Ω–µ –º–æ–∂–µ—Ç –æ—Å—Ç–∞–≤–∞—Ç—å—Å—è –Ω–∞–µ–¥–∏–Ω–µ —Å –∫–∞–ø—É—Å—Ç–æ–π (—Å—ä–µ—Å—Ç).

–¢–≤–æ—è —Ü–µ–ª—å:
1. –ù–∞–π–¥–∏ —Ä–µ—à–µ–Ω–∏–µ
2. –¢—â–∞—Ç–µ–ª—å–Ω–æ –ø—Ä–æ–≤–µ—Ä—å –∫–∞–∂–¥—ã–π —à–∞–≥
3. –£–±–µ–¥–∏—Å—å, —á—Ç–æ –Ω–µ—Ç –Ω–∞—Ä—É—à–µ–Ω–∏–π —É—Å–ª–æ–≤–∏–π
4. –ü—Ä–µ–¥–ª–æ–∂–∏ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã, –µ—Å–ª–∏ –µ—Å—Ç—å

–ë—É–¥—å –ø–µ–¥–∞–Ω—Ç–∏—á–Ω—ã–º –∏ –≤–Ω–∏–º–∞—Ç–µ–ª—å–Ω—ã–º –∫ –¥–µ—Ç–∞–ª—è–º.`,
		},
	}

	responses := make([]string, 0, len(experts))
	totalTokens := 0
	start := time.Now()

	for i, expert := range experts {
		fmt.Printf("\n%s –≠–∫—Å–ø–µ—Ä—Ç %d: %s\n", expert.Emoji, i+1, expert.Role)
		fmt.Printf("–ü—Ä–æ–º–ø—Ç:\n%s\n\n", expert.Prompt)

		resp, err := aiClient.CreateCompletion(client.CompletionRequest{
			Prompt:      expert.Prompt,
			Temperature: 0.7,
			MaxTokens:   500,
		})

		if err != nil {
			log.Printf("–û—à–∏–±–∫–∞ –¥–ª—è —ç–∫—Å–ø–µ—Ä—Ç–∞ %s: %v\n", expert.Role, err)
			continue
		}

		fmt.Printf("–û—Ç–≤–µ—Ç:\n%s\n\n", resp.Content)
		utils.PrintTokenStats(resp.TotalTokens, resp.PromptTokens, resp.CompletionTokens)

		responses = append(responses, fmt.Sprintf("=== %s %s ===\n%s", expert.Emoji, expert.Role, resp.Content))
		totalTokens += resp.TotalTokens
	}

	elapsed := time.Since(start)

	// –û–±—ä–µ–¥–∏–Ω—è–µ–º –æ—Ç–≤–µ—Ç—ã –≤—Å–µ—Ö —ç–∫—Å–ø–µ—Ä—Ç–æ–≤
	combinedResponse := strings.Join(responses, "\n\n")

	utils.PrintKeyValue("–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è", elapsed.String())
	utils.PrintKeyValue("–¢–æ–∫–µ–Ω–æ–≤ –≤—Å–µ–≥–æ", fmt.Sprintf("%d", totalTokens))
	utils.PrintDivider()

	return StrategyResult{
		StrategyName:  "–ì—Ä—É–ø–ø–∞ —ç–∫—Å–ø–µ—Ä—Ç–æ–≤",
		Prompt:        "–°–º. –ø—Ä–æ–º–ø—Ç—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —ç–∫—Å–ø–µ—Ä—Ç–∞ –≤—ã—à–µ",
		Response:      combinedResponse,
		TokensUsed:    totalTokens,
		ExecutionTime: elapsed,
	}
}

// –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –≤—Å–µ—Ö —Å—Ç—Ä–∞—Ç–µ–≥–∏–π
func compareResults(results []StrategyResult) {
	utils.PrintSection("üìä", "–°–†–ê–í–ù–ï–ù–ò–ï –†–ï–ó–£–õ–¨–¢–ê–¢–û–í")

	// –¢–∞–±–ª–∏—Ü–∞ —Å –æ—Å–Ω–æ–≤–Ω—ã–º–∏ –º–µ—Ç—Ä–∏–∫–∞–º–∏
	fmt.Println("\n‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê")
	fmt.Println("‚îÇ –°—Ç—Ä–∞—Ç–µ–≥–∏—è               ‚îÇ –¢–æ–∫–µ–Ω—ã    ‚îÇ –í—Ä–µ–º—è           ‚îÇ")
	fmt.Println("‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§")

	for _, result := range results {
		fmt.Printf("‚îÇ %-23s ‚îÇ %9d ‚îÇ %15s ‚îÇ\n",
			truncate(result.StrategyName, 23),
			result.TokensUsed,
			result.ExecutionTime.Round(time.Millisecond),
		)
	}

	fmt.Println("‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò")

	// –ê–Ω–∞–ª–∏–∑ –∫–∞–∂–¥–æ–π —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏
	fmt.Println("\nüìù –î–ï–¢–ê–õ–¨–ù–´–ô –ê–ù–ê–õ–ò–ó:\n")

	analyses := []struct {
		name string
		pros []string
		cons []string
	}{
		{
			name: "1. –ü—Ä—è–º–æ–π –æ—Ç–≤–µ—Ç",
			pros: []string{
				"–ë—ã—Å—Ç—Ä–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ",
				"–ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–∫–µ–Ω–æ–≤",
				"–ü—Ä–æ—Å—Ç–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è",
			},
			cons: []string{
				"–ú–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ–ø–æ–ª–Ω—ã–º",
				"–ù–µ—Ç –≥–∞—Ä–∞–Ω—Ç–∏–∏ –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ —Ä–∞—Å—Å—É–∂–¥–µ–Ω–∏—è",
				"–ó–∞–≤–∏—Å–∏—Ç –æ—Ç –±–∞–∑–æ–≤—ã—Ö –∑–Ω–∞–Ω–∏–π –º–æ–¥–µ–ª–∏",
			},
		},
		{
			name: "2. –ü–æ—à–∞–≥–æ–≤–æ–µ —Ä–µ—à–µ–Ω–∏–µ",
			pros: []string{
				"–î–µ—Ç–∞–ª—å–Ω–æ–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–∞",
				"–°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ–¥—Ö–æ–¥",
				"–ú–µ–Ω—å—à–µ –æ—à–∏–±–æ–∫ –±–ª–∞–≥–æ–¥–∞—Ä—è –ø—Ä–æ–≤–µ—Ä–∫–µ –Ω–∞ –∫–∞–∂–¥–æ–º —à–∞–≥–µ",
				"–ü–æ–Ω—è—Ç–Ω–æ, –∫–∞–∫ –º–æ–¥–µ–ª—å –ø—Ä–∏—à–ª–∞ –∫ —Ä–µ—à–µ–Ω–∏—é",
			},
			cons: []string{
				"–ë–æ–ª—å—à–µ —Ç–æ–∫–µ–Ω–æ–≤ (–≤—ã—à–µ —Å—Ç–æ–∏–º–æ—Å—Ç—å)",
				"–î–æ–ª—å—à–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ",
			},
		},
		{
			name: "3. –ú–µ—Ç–∞-–ø—Ä–æ–º–ø—Ç",
			pros: []string{
				"–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø—Ä–æ–º–ø—Ç –ø–æ–¥ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é –∑–∞–¥–∞—á—É",
				"–ú–æ–¥–µ–ª—å —Å–∞–º–∞ —Ñ–æ—Ä–º—É–ª–∏—Ä—É–µ—Ç –ª—É—á—à–∏–π –ø–æ–¥—Ö–æ–¥",
				"–ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ –±–æ–ª–µ–µ –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ",
			},
			cons: []string{
				"–î–≤–∞ –∑–∞–ø—Ä–æ—Å–∞ –≤–º–µ—Å—Ç–æ –æ–¥–Ω–æ–≥–æ (2x —Å—Ç–æ–∏–º–æ—Å—Ç—å)",
				"–°–∞–º–æ–µ –¥–æ–ª–≥–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ",
				"–ù–µ –≤—Å–µ–≥–¥–∞ –ª—É—á—à–µ –ø—Ä—è–º–æ–≥–æ –ø–æ—à–∞–≥–æ–≤–æ–≥–æ –ø–æ–¥—Ö–æ–¥–∞",
			},
		},
		{
			name: "4. –ì—Ä—É–ø–ø–∞ —ç–∫—Å–ø–µ—Ä—Ç–æ–≤",
			pros: []string{
				"–†–∞–∑–Ω—ã–µ —É–≥–ª—ã –∑—Ä–µ–Ω–∏—è –Ω–∞ –∑–∞–¥–∞—á—É",
				"–í–∑–∞–∏–º–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ—à–µ–Ω–∏–π",
				"–ë–æ–ª–µ–µ –≥–ª—É–±–æ–∫–∏–π –∞–Ω–∞–ª–∏–∑",
				"–ú–æ–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å –ª—É—á—à–µ–µ —Ä–µ—à–µ–Ω–∏–µ",
			},
			cons: []string{
				"–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–∫–µ–Ω–æ–≤",
				"–ù–µ—Å–∫–æ–ª—å–∫–æ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤",
				"–ò–∑–±—ã—Ç–æ—á–Ω–æ –¥–ª—è –ø—Ä–æ—Å—Ç—ã—Ö –∑–∞–¥–∞—á",
			},
		},
	}

	for i, analysis := range analyses {
		fmt.Printf("%s\n", analysis.name)

		fmt.Println("\n–ü–ª—é—Å—ã:")
		for _, pro := range analysis.pros {
			utils.PrintSuccess(pro)
		}

		fmt.Println("\n–ú–∏–Ω—É—Å—ã:")
		for _, con := range analysis.cons {
			utils.PrintError(con)
		}

		if i < len(analyses)-1 {
			fmt.Println()
		}
	}

	// –ò—Ç–æ–≥–æ–≤—ã–π –≤—ã–≤–æ–¥
	fmt.Println()
	utils.PrintSection("üéØ", "–í–´–í–û–î–´")

	fmt.Println("–î–ª—è –ø—Ä–æ—Å—Ç—ã—Ö –∑–∞–¥–∞—á:")
	utils.PrintInfo("  ‚Üí –ü—Ä—è–º–æ–π –æ—Ç–≤–µ—Ç –∏–ª–∏ –ø–æ—à–∞–≥–æ–≤–æ–µ —Ä–µ—à–µ–Ω–∏–µ")

	fmt.Println("\n–î–ª—è —Å–ª–æ–∂–Ω—ã—Ö –ª–æ–≥–∏—á–µ—Å–∫–∏—Ö –∑–∞–¥–∞—á:")
	utils.PrintInfo("  ‚Üí –ü–æ—à–∞–≥–æ–≤–æ–µ —Ä–µ—à–µ–Ω–∏–µ (–±–∞–ª–∞–Ω—Å –∫–∞—á–µ—Å—Ç–≤–∞ –∏ —Å—Ç–æ–∏–º–æ—Å—Ç–∏)")

	fmt.Println("\n–î–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω—ã—Ö —Ä–µ—à–µ–Ω–∏–π:")
	utils.PrintInfo("  ‚Üí –ì—Ä—É–ø–ø–∞ —ç–∫—Å–ø–µ—Ä—Ç–æ–≤ (–≤–∑–∞–∏–º–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞)")

	fmt.Println("\n–î–ª—è –∏—Å—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –∑–∞–¥–∞—á:")
	utils.PrintInfo("  ‚Üí –ú–µ—Ç–∞-–ø—Ä–æ–º–ø—Ç (–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø–æ–¥—Ö–æ–¥–∞)")

	fmt.Println()
	utils.PrintSuccess("–í—Å–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –¥–∞–ª–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ!")
	utils.PrintInfo("–í—ã–±–æ—Ä —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –±–∞–ª–∞–Ω—Å–∞ –º–µ–∂–¥—É –∫–∞—á–µ—Å—Ç–≤–æ–º, —Å—Ç–æ–∏–º–æ—Å—Ç—å—é –∏ –≤—Ä–µ–º–µ–Ω–µ–º")
}

// –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±—Ä–µ–∑–∫–∏ —Å—Ç—Ä–æ–∫
func truncate(s string, maxLen int) string {
	if len(s) <= maxLen {
		return s
	}
	return s[:maxLen-3] + "..."
}
